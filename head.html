<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3HX94WD1PS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3HX94WD1PS');
</script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(91314673, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true,
        ecommerce:"dataLayer"
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/91314673" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<script src="https://www.google.com/recaptcha/enterprise.js" async defer></script>

<script>
    const config = {
        production: {
            carouselBlockId: "block-03e781ba4c1647c3ae5897f233a03442",
            buttonBlockId: "#block-0ce947a4080e4ac39624c276f7580991",
            replaceBlockId: "#block-0ce947a4080e4ac39624c276f7580991",
            address: "https://vpn-naoborot.online/"    
        },
        test: {
            carouselBlockId: "block-cb7cecee864a47af815c267ff4a1b333",
            buttonBlockId: "#block-a1ed09dd090f4b518a4514e8ad93b590",
            replaceBlockId: "#block-a1ed09dd090f4b518a4514e8ad93b590",
            address: "https://test-vpnn.super.site/"
        }
    };

    const environment = window.location.hostname.includes("test-vpnn.super.site") ? "test" : "production";
    
    console.log('Environment: ', environment)
</script>

<script>
function embed_reviews() {
  
    console.log('Embedding reviews')
    document.getElementById(config[environment].carouselBlockId).innerHTML = '<div id="reviewsio-carousel-widget"></div>';

    new carouselInlineWidget('reviewsio-carousel-widget',{
        store: 'vpn-naoborot.online',
        sku: '',
        lang: 'en',
        carousel_type: 'topHeader',
        styles_carousel: 'CarouselWidget--topHeader',
  
        options:{
          general:{
            review_type: 'company, product',
            min_reviews: '1',
            max_reviews: '20',
            address_format: 'CITY, COUNTRY',
            enable_auto_scroll: 10000,
          },
          header:{
            enable_overall_stars: true,
            rating_decimal_places: 2,
          },
          reviews: {
            enable_customer_name: true,
            enable_customer_location: false,
            enable_verified_badge: true,
            enable_recommends_badge: true,
            enable_photos: true,
            enable_videos: true,
            enable_review_date: true,
            disable_same_customer: true,
            min_review_percent: 4,
            third_party_source: true,
            hide_empty_reviews: true,
            enable_product_name: true,
            tags: "",
            branch: "",
            enable_branch_name: false,
          },
          popups: {
            enable_review_popups:  true,
            enable_helpful_buttons: true,
            enable_helpful_count: true,
            enable_share_buttons: true,
          },
      },
      translations: {
        verified_customer:  "Verified Customer",
      },
      styles:{
        '--base-font-size': '16px',
        '--base-maxwidth':'100%',
        '--reviewsio-logo-style':'var(--logo-normal)',
        '--common-star-color':'#3B82F6',
        '--common-star-disabled-color':' rgba(0,0,0,0.25)',
        '--medium-star-size':' 22px',
        '--small-star-size':'19px', /*Modal*/
        '--x-small-star-size':'16px',
        '--x-small-star-display':'inline-flex',
  
        '--header-order':'1',
        '--header-width':'160px',
        '--header-bg-start-color':'transparent',
        '--header-bg-end-color':'transparent',
        '--header-gradient-direction':'135deg',
        '--header-padding':'0.5em',
        '--header-border-width':'0px',
        '--header-border-color':'rgba(0,0,0,0.1)',
        '--header-border-radius':'0px',
        '--header-shadow-size':'0px',
        '--header-shadow-color':'rgba(0, 0, 0, 0.1)',
  
        '--header-star-color':'inherit',
        '--header-disabled-star-color':'inherit',
        '--header-heading-text-color':'inherit',
        '--header-heading-font-size':'inherit',
        '--header-heading-font-weight':'inherit',
        '--header-heading-line-height':'inherit',
        '--header-heading-text-transform':'inherit',
        '--header-subheading-text-color':'inherit',
        '--header-subheading-font-size':'inherit',
        '--header-subheading-font-weight':'inherit',
        '--header-subheading-line-height':'inherit',
        '--header-subheading-text-transform':'inherit',
  
        '--item-maximum-columns':'5',/*Must be 3 or larger*/
        '--item-background-start-color':'transparent',
        '--item-background-end-color':'transparent',
        '--item-gradient-direction':'135deg',
        '--item-padding':'0.5em',
        '--item-border-width':'0px',
        '--item-border-color':'rgba(0,0,0,0.1)',
        '--item-border-radius':'0px',
        '--item-shadow-size':'0px',
        '--item-shadow-color':'rgba(0,0,0,0.1)',
  
        '--heading-text-color':' #0E1311',
        '--heading-text-font-weight':' 600',
        '--heading-text-font-family':' inherit',
        '--heading-text-line-height':' 1.4',
        '--heading-text-letter-spacing':'0',
        '--heading-text-transform':'none',
  
        '--body-text-color':' #0E1311',
        '--body-text-font-weight':'400',
        '--body-text-font-family':' inherit',
        '--body-text-line-height':' 1.4',
        '--body-text-letter-spacing':'0',
        '--body-text-transform':'none',
  
        '--scroll-button-icon-color':'#0E1311',
        '--scroll-button-icon-size':'24px',
        '--scroll-button-bg-color':'transparent',
  
        '--scroll-button-border-width':'0px',
        '--scroll-button-border-color':'rgba(0,0,0,0.1)',
  
        '--scroll-button-border-radius':'60px',
        '--scroll-button-shadow-size':'0px',
        '--scroll-button-shadow-color':'rgba(0,0,0,0.1)',
        '--scroll-button-horizontal-position':'0px',
        '--scroll-button-vertical-position':'0px',
  
        '--badge-icon-color':'#0E1311',
        '--badge-icon-font-size':'15px',
        '--badge-text-color':'#0E1311',
        '--badge-text-font-size':'inherit',
        '--badge-text-letter-spacing':'inherit',
        '--badge-text-transform':'inherit',
  
        '--author-font-size':'inherit',
        '--author-font-weight':'inherit',
        '--author-text-transform':'inherit',
  
        '--photo-video-thumbnail-size':'60px',
        '--photo-video-thumbnail-border-radius':'0px',
  
        '--popup-backdrop-color':'rgba(0,0,0,0.75)',
        '--popup-color':'#ffffff',
        '--popup-star-color':'inherit',
        '--popup-disabled-star-color':'inherit',
        '--popup-heading-text-color':'inherit',
        '--popup-body-text-color':'inherit',
        '--popup-badge-icon-color':'inherit',
        '--popup-badge-icon-font-size':'19px',
        '--popup-badge-text-color':'inherit',
        '--popup-badge-text-font-size':'14px',
        '--popup-border-width':'0px',
        '--popup-border-color':'rgba(0,0,0,0.1)',
        '--popup-border-radius':'0px',
        '--popup-shadow-size':'0px',
        '--popup-shadow-color':'rgba(0,0,0,0.1)',
        '--popup-icon-color':'#0E1311',
  
        '--tooltip-bg-color':'#0E1311',
        '--tooltip-text-color':'#ffffff',
      },
    });
}

window.addEventListener("load", (event) => {
  window.test = (window.location.hash.includes("debug") || window.location.search.includes("debug"))
    
  console.log("Loaded. Test:", window.test)
  setTimeout(function () {embed_reviews()},1000)
})
</script>

<script>
  window.intercomSettings = {
    api_base: "https://api-iam.intercom.io",
    app_id: "y5urxrqf"
  };
</script>

<script defer src="https://widget.cloudpayments.ru/bundles/cloudpayments.js"></script>

<script>
  window.addEventListener('message', handleMessage, false);
    
  function sendAnalyticsEvent(event_label) {
      if (window.test) {
          console.log("Test mode - analytics skipped");
          return;
      }
      
      gtag('event', event_label);
      ym(91314673,'reachGoal', event_label)
  }
    
    window.tarifs = {
        "üìÇ –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤" : {
            "description": "VPN –ù–∞–æ–±–æ—Ä–æ—Ç ‚Äì –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.\
 –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂.",
            "rub-descriptions": {
              "1-month":  "VPN –ù–∞–æ–±–æ—Ä–æ—Ç ‚Äì –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.\
 –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂.",
              "6-month": "VPN –ù–∞–æ–±–æ—Ä–æ—Ç ‚Äì –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.\
 –ü–ª–∞—Ç—ë–∂ —Ä–∞–∑ –≤ 6 –º–µ—Å—è—Ü–µ–≤.",
              "1-year":  "VPN –ù–∞–æ–±–æ—Ä–æ—Ç ‚Äì –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.\
 –ï–∂–µ–≥–æ–¥–Ω—ã–π –ø–ª–∞—Ç—ë–∂."
            },
            "price": 290,
            "rub-prices": {
              "1-month": 290,
              "6-month": 1140,
              "1-year": 1800,
            },
            "stripe-url": "https://buy.stripe.com/bIYbL00OY8JH6o8bII",
            "stripe-urls": {
              "1-month": "https://buy.stripe.com/eVacP42X6bVTbIs5kw",
              "6-month": "https://buy.stripe.com/14k5mC69igc96o814f",
              "1-year": "https://buy.stripe.com/9AQ6qG1T28JHfYI8wG",
            },
            currencies: [
                {
                    "stripe-url": "https://buy.stripe.com/9AQ6qG1T28JHfYI8wG",
                    currency: "‚Ç¨",
                    price: 1,
                    plans: [
                        {
                            "stripe-url": "https://buy.stripe.com/14k5mC69igc96o814f",
                            period: 6,
                            price: 2,
                            currency: "‚Ç¨"
                        },
                        {
                            period: 1,
                            price: 3,
                            currency: "‚Ç¨",
                            "stripe-url": "https://buy.stripe.com/eVacP42X6bVTbIs5kw",
                        },
                    ],

                }
            ],
            plans: [
                {
                    period: 6,
                    price: 190,
                    currency: "‚ÇΩ"
                },
                {
                    period: 1,
                    price: 290,
                    currency: "‚ÇΩ"
                },
            ],
        },
        "üì∫ –î–ª—è –í–∏–¥–µ–æ": {
            "description": "VPN –ù–∞–æ–±–æ—Ä–æ—Ç ‚Äì –î–ª—è –≤–∏–¥–µ–æ. –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂.",
            "rub-descriptions": {
              "1-month":  "VPN –ù–∞–æ–±–æ—Ä–æ—Ç ‚Äì –î–ª—è –≤–∏–¥–µ–æ.\
 –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂.",
              "6-month": "VPN –ù–∞–æ–±–æ—Ä–æ—Ç ‚Äì –î–ª—è –≤–∏–¥–µ–æ. \
 –ü–ª–∞—Ç—ë–∂ —Ä–∞–∑ –≤ 6 –º–µ—Å—è—Ü–µ–≤.",
              "1-year":  "VPN –ù–∞–æ–±–æ—Ä–æ—Ç ‚Äì –î–ª—è –≤–∏–¥–µ–æ. \
 –ï–∂–µ–≥–æ–¥–Ω—ã–π –ø–ª–∞—Ç—ë–∂."
            },
            "price": 590,
            "rub-prices": {
              "1-month": 590,
              "6-month": 2700,
              "1-year": 3480,
            },
            "stripe-url": "https://buy.stripe.com/aEU6qGeFO1hf27S5kl",
            "stripe-urls": {
              "1-month": "https://buy.stripe.com/fZeeXc1T26Bz7sc3cq",
              "6-month": "https://buy.stripe.com/00gdT869i2lj5k4cMZ",
              "1-year": "https://buy.stripe.com/9AQ02icxG4trfYI6ov",
            },
            currencies: [
                {
                    "stripe-url": "https://buy.stripe.com/9AQ02icxG4trfYI6ov",
                    currency: "‚Ç¨",
                    price: 1,
                    plans: [
                        {
                            "stripe-url": "https://buy.stripe.com/00gdT869i2lj5k4cMZ",
                            period: 6,
                            price: 2,
                            currency: "‚Ç¨"
                        },
                        {
                            period: 1,
                            price: 3,
                            currency: "‚Ç¨",
                            "stripe-url": "https://buy.stripe.com/fZeeXc1T26Bz7sc3cq",
                        },
                    ],

                }
            ],
            plans: [
                {
                    period: 6,
                    price: 190,
                    currency: "‚ÇΩ"
                },
                {
                    period: 1,
                    price: 290,
                    currency: "‚ÇΩ"
                },
            ],
        },
        "üòé –õ–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä": {
            "description": "VPN –ù–∞–æ–±–æ—Ä–æ—Ç ‚Äì –õ–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä. –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂.",
            "rub-descriptions": {
              "1-month":  "VPN –ù–∞–æ–±–æ—Ä–æ—Ç ‚Äì –õ–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä.\
 –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂.",
              "6-month": "VPN –ù–∞–æ–±–æ—Ä–æ—Ç ‚Äì –õ–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä.\
 –ü–ª–∞—Ç—ë–∂ —Ä–∞–∑ –≤ 6 –º–µ—Å—è—Ü–µ–≤.",
              "1-year":  "VPN –ù–∞–æ–±–æ—Ä–æ—Ç ‚Äì –õ–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä.\
 –ï–∂–µ–≥–æ–¥–Ω—ã–π –ø–ª–∞—Ç—ë–∂."
            },
            "price": 1490,
            "rub-prices": {
              "1-month": 1490,
              "6-month": 5940,
              "1-year": 9480,
            },
            "stripe-url":"https://buy.stripe.com/cN2aGWapy8JHaEobIL",
            "stripe-urls": {
              "1-month": "https://buy.stripe.com/00g16mapy0dbh2MdQS",
              "6-month": "https://buy.stripe.com/fZe5mC41a4trh2M28c",
              "1-year": "https://buy.stripe.com/8wMaGWbtC3pn13O3cl",
            },
            currencies: [
                {
                    "stripe-url": "https://buy.stripe.com/8wMaGWbtC3pn13O3cl",
                    currency: "‚Ç¨",
                    price: 1.5,
                    plans: [
                        {
                            "stripe-url": "https://buy.stripe.com/fZe5mC41a4trh2M28c",
                            period: 6,
                            price: 2,
                            currency: "‚Ç¨"
                        },
                        {
                            period: 1,
                            price: 3,
                            currency: "‚Ç¨",
                            "stripe-url": "https://buy.stripe.com/00g16mapy0dbh2MdQS",
                        },
                    ],
                }
            ],
            plans: [
                {
                    period: 6,
                    price: 190,
                    currency: "‚ÇΩ"
                },
                {
                    period: 1,
                    price: 290,
                    currency: "‚ÇΩ"
                },
            ],
        },
    }
    
  function showPaymentWidget(email, tarif, billing_cycle = "1-month") {
     
    console.log("showing Payment widget")
     
    const tarif_id = Object.keys(window.tarifs).filter(item => item == tarif)[0]
    
    const periods = {
            "1-month": 1,
            "6-month": 6,
            "1-year": 12,
          }
          
    const price = window.tarifs[tarif]["rub-prices"][billing_cycle]
    const period = periods[billing_cycle]
    const description = window.tarifs[tarif]["rub-descriptions"][billing_cycle]
     
    pay(email, price, description, tarif_id, period);
  }
  
  function getStripePaymentLink(email, tarif, billing_cycle) {
    if (!billing_cycle) {
      billing_cycle = "1-month"
    }
    let encodedEmail = btoa(email);
    let urlSafeEncodedEmail = encodedEmail.replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');

    url = "https://vpnnonline.com?link=" +  tarifs[tarif]["stripe-urls"][billing_cycle] + "?prefilled_email=" + encodeURIComponent(email) + "&client_reference_id=" + urlSafeEncodedEmail
    console.log("Redirecting to ", url)
    return url
  }
  const API_URL = "https://api.vpn-naoborot.online/v1/";

  const redirectWithDelay = (email) => {
    const interval = setInterval(async () => {
        await fetchUser(email)
    }, 10000)
}

const fetchUser = async (email) => {
    return await fetch(API_URL + `get-token-by-email/?email=${encodeURIComponent(email)}`).then(result => {
        return result.json();
    }).then(response => {
        if (response.code === 200 && response.auth_token && response.auth_token !== "") {
            window.location = "https://lk.vpn-naoborot.online/?auth_token=" + response.auth_token
        }
        return response
    })
}

this.pay = function (email, price, description, tarif_id, period = 1) {
    
    var widget = new cp.CloudPayments();
    console.log(window.attempt)
    
    var receipt = {
            Items: [
                 {
                    label: description, 
                    price: price, 
                    quantity: 1.00, 
                    amount: price, 
                    vat: null, 
                    method: 4, 
                    object: 4, 
                }
            ],
            CalculationPlace: "vpn-naoborot.online",
            taxationSystem: 2, 
            email: email, 
            isBso: false, 
            amounts:
            {
                electronic: price,
                advancePayment: 0.00, 
                credit: 0.00, 
                provision: 0.00 
            }
        };

        var data = {};
        data.CloudPayments = {
            CustomerReceipt: receipt, 
            recurrent: {
             interval: 'Month',
             period: period, 
             customerReceipt: receipt 
             }
             };
        data['tarif_id'] = tarif_id;

        widget.pay('charge', 
        { 
            publicId: 'pk_e7d787f0deecc2d9f27183be0841b', 
            description: description, 
            amount: price, 
            currency: 'RUB', 
            accountId: email,
            email: email,
            data: data,
        },
        {
            onSuccess: async function (options) { 
                    await fetchUser(email);

                    console.log("Payment succeded!");
                    if (!window.location.hash.includes("debug")){
                        sendAnalyticsEvent("successful_payment");
                    }
                }
        }
        )
    };
  
  function processPayment(paymentMethod, email, tarif, billing_cycle){
    
    console.log('processPayment', paymentMethod)
    if (paymentMethod == '–ó–∞—Ä—É–±–µ–∂–Ω–æ–π –∫–∞—Ä—Ç–æ–π') {
      URL = getStripePaymentLink(email, tarif, billing_cycle)
      window.open(URL, '_blank');
            redirectWithDelay(email)
      return
    }
    showPaymentWidget(email, tarif, billing_cycle)  
  }
  
  function getFormName(name){
    let gevent = "";
    switch (name){
            case 'ü§ù –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π':
                gevent = "form_free"
                break;
              case 'üìÇ –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤':
                gevent = "form_docs"
                break;
              case 'üì∫ –î–ª—è –í–∏–¥–µ–æ':
                gevent = "form_video"
                break;
              case 'üòé –õ–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä':
                gevent = "form_server"
                break;
          }
          return gevent
}
  
  function handleMessage(event) {  
      try {

          if (event.origin != "https://noteforms.com"
            & event.origin != "https://vpn-naoborot.online"
            & event.origin != "https://test-vpnn.super.site") { 
                console.log("wrong origin:",event.origin); 
                return; 
          }  

          console.log("Parent got message: ", event)

          if (typeof event.data !== 'string') {
              console.log("This is not my event:", event.data);
              return;
          }
          
          let eventData;
          try {
              eventData = JSON.parse(event.data);
          } catch (error) {
            //   console.error("Failed to parse event data:", error);
              return;
          }
          console.log(eventData)

          if (!eventData.hasOwnProperty('tarif') || !eventData.hasOwnProperty('status')) {
              console.log("This is not my event:", event);
              return;
          }

          if (eventData["status"] == "fail") {
              sendAnalyticsEvent("send_form_all_fail");
              return;
          } else {
              sendAnalyticsEvent("send_form_all");
          }

          var gevent = "";
          switch (eventData["tarif"]){
              case 'ü§ù –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π':
                gevent = "send_form_free"
                break;
              case 'üìÇ –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤':
                gevent = "send_form_docs"
                break;
              case 'üì∫ –î–ª—è –í–∏–¥–µ–æ':
                gevent = "send_form_video"
                break;
              case 'üòé –õ–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä':
                gevent = "send_form_server"
                break;
          }

          if (eventData["status"] == "fail") {
              gevent = gevent + "_fail";
          }
          sendAnalyticsEvent(gevent);

          if (eventData["status"] == "success") {
               processPayment(eventData["paymentMethod"], eventData["email"], eventData["tarif"], eventData["billing_cycle"]?eventData["billing_cycle"]:undefined)
          }
    } catch (error) {
          console.error(error);
    }
 }
/// TARIF BLOCK  

    window.addEventListener('load', () => {

        let defaultCurrency = localStorage.getItem('defaultCurrency')
        if (!defaultCurrency) {
            defaultCurrency = '‚Ç¨';
            localStorage.setItem('defaultCurrency', '‚Ç¨')
        }
        const content = `<div class="container">
<div class="row">
    <div class="col-12 d-flex w-100 justify-content-center">

               <ul class="custom-switch-box ">
                      <li class="radio-currency">
                        <input id="s1" type="radio"   data-item data-value="‚Ç¨" data-name="–ï–≤—Ä–æ" ${defaultCurrency === '‚Ç¨' ? `checked` : ''}  name="radio" class="switch " >
                        <label for="s1">–í –ï–≤—Ä–æ</label>
                      </li>
                      <li class="radio-currency">
                        <input id="s2" type="radio" data-item data-value="‚ÇΩ" data-name="–†—É–±–ª–∏" ${defaultCurrency === '‚ÇΩ' ? `checked` : ''}  name="radio" class="switch " >
                        <label for="s2">–í –†—É–±–ª—è—Ö</label>
                      </li>
              </ul>
    </div>
</div>
<div class="cards row">
</div>
</div>`;
        const appendBlock = (replace) => {
            replace.innerHTML = content;
            const items = [
                {
                    icon: "ü§ù",
                    name: "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π",
                    image: "/assets/images/personal.png",
                    description: "–î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –ñ–ö–•, –Ω–∞–ª–æ–≥–æ–≤, –∫–∞–¥–∞—Å—Ç—Ä–∞ –∏ —Ç.–ø.",
                    price: "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ",
                    currency: "‚ÇΩ",
                    period: 12,
                    currencies: [
                        {
                            currency: "‚Ç¨",
                            price: "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ",
                            plans: []
                        },
                    ],
                    plans: [],
                    tariff: "ü§ù  –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π",
                    secondary_info: "–ë—É–¥–µ–º —Ä–∞–¥—ã –≤–∞—à–∏–º –¥–æ–Ω–∞—Ç–∞–º",
                    button: "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è",
                    features: ["üê¢ 1 –ú–±–∏—Ç/—Å", "‚úÖ –î–æ—Å—Ç—É–ø –∫ —Å–∞–π—Ç–∞–º", "‚è≥ –ö–ª—é—á –ø—Ä–∏–¥—ë—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ —Å—É—Ç–æ–∫", "üõë –†–∞–±–æ—Ç–∞–µ—Ç 1 –¥–µ–Ω—å", "üõë –ù–µ–ª—å–∑—è —Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ –∏ –∫–∞—á–∞—Ç—å –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã"],
                    speed: "~1 –ú–±–∏—Ç/—Å",
                    plan_color: "color-yellow",
                    button_color: ""
                },
                {
                    name: "–î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤",
                    tariff: "üìÇ  –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤",
                    image: "/assets/images/pro.png",
                    icon: "üìÇ",
                    description: "–ö–∞–∫ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π, –Ω–æ —á—É—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ.",
                    price: 150,
                    currency: "‚ÇΩ",
                    period: 12,
                    currencies: [
                        {
                            currency: "‚Ç¨",
                            price: 1.5,
                            plans: [
                                {
                                    period: 6,
                                    price: 2,
                                    currency: "‚Ç¨"
                                },
                                {
                                    period: 1,
                                    price: 3,
                                    currency: "‚Ç¨"
                                },
                            ],
                        }
                    ],
                    plans: [
                        {
                            period: 6,
                            price: 190,
                            currency: "‚ÇΩ"
                        },
                        {
                            period: 1,
                            price: 290,
                            currency: "‚ÇΩ"
                        },
                    ],
                    secondary_info: "",
                    button: "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è",
                    features: ["üöú 2 –ú–±–∏—Ç/—Å", "‚úÖ –î–æ—Å—Ç—É–ø –∫ —Å–∞–π—Ç–∞–º", "‚úÖ –ö–ª—é—á –ø—Ä–∏–¥—ë—Ç –∑–∞ –ø–∞—Ä—É –º–∏–Ω—É—Ç",
                        "‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞",
                        "üõë –ù–µ–ª—å–∑—è —Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ –∏ –∫–∞—á–∞—Ç—å –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã",
                        "üíô –ó–∞–±–æ—Ç–ª–∏–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞"
                    ],
                    speed: "~2 –ú–±–∏—Ç/—Å",
                    plan_color: "color-blue",
                    button_color: "",

                },
                {
                    icon: "üì∫",
                    name: "–î–ª—è –í–∏–¥–µ–æ",
                    tariff: "üì∫ –î–ª—è –í–∏–¥–µ–æ",
                    image: "/assets/images/team.png",
                    description: "–î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π –∏ —É–¥–∞–ª—ë–Ω–Ω–æ–π —É—á—ë–±—ã.",
                    price: 290,
                    currency: "‚ÇΩ",
                    period: 12,
                    currencies: [
                        {
                            currency: "‚Ç¨",
                            price: 3,
                            period: 12,
                            plans: [
                                {
                                    period: 6,
                                    price: 4.5,
                                    currency: "‚Ç¨"
                                },
                                {
                                    period: 1,
                                    price: 6,
                                    currency: "‚Ç¨"
                                },
                            ],
                        }
                    ],
                    plans: [
                        {
                            period: 6,
                            price: 450,
                            currency: "‚ÇΩ"
                        },
                        {
                            period: 1,
                            price: 590,
                            currency: "‚ÇΩ"
                        },
                    ],
                    secondary_info: "",
                    button: "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è",
                    features: ["üèéÔ∏è 10 –ú–±–∏—Ç/—Å", "‚úÖ –î–æ—Å—Ç—É–ø –∫ —Å–∞–π—Ç–∞–º", "‚úÖ –ö–ª—é—á –ø—Ä–∏–¥—ë—Ç –∑–∞ –ø–∞—Ä—É –º–∏–Ω—É—Ç",
                        "‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞",
                        "‚úÖ –ú–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ –∏ –∫–∞—á–∞—Ç—å –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã",
                        "üíô –ó–∞–±–æ—Ç–ª–∏–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞",
                        "üì∂ –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å"
                    ],
                    speed: "~10 –ú–±–∏—Ç/—Å",
                    plan_color: "color-red",
                    button_color: "bg-dodger-blue",
                },
                {
                    icon: "üòé",
                    tariff: "üòé –õ–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä",
                    name: "–õ–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä",
                    image: "/assets/images/enterprise.png",
                    description: "–î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π, —É–¥–∞–ª—ë–Ω–Ω–æ–π —É—á—ë–±—ã –∏ —Ä–∞–±–æ—Ç—ã.",
                    price: 790,
                    currency: "‚ÇΩ",
                    period: 12,
                    currencies: [
                        {
                            currency: "‚Ç¨",
                            price: 8,
                            period: 12,
                            plans: [
                                {
                                    period: 6,
                                    price: 10,
                                    currency: "‚Ç¨"
                                },
                                {
                                    period: 1,
                                    price: 15,
                                    currency: "‚Ç¨"
                                },
                            ],
                        }
                    ],
                    plans: [
                        {
                            period: 6,
                            price: 990,
                            currency: "‚ÇΩ"
                        },
                        {
                            period: 1,
                            price: 1490,
                            currency: "‚ÇΩ"
                        },
                    ],
                    secondary_info: "",
                    button: "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è",
                    features: [
                        "üöÄ 40 –ú–±–∏—Ç/—Å",
                        "‚úÖ –î–æ—Å—Ç—É–ø –∫ —Å–∞–π—Ç–∞–º", "‚úÖ –ö–ª—é—á –ø—Ä–∏–¥—ë—Ç –∑–∞ –ø–∞—Ä—É –º–∏–Ω—É—Ç",
                        "‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞",
                        "‚úÖ –ú–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ –∏ –∫–∞—á–∞—Ç—å –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã",
                        "üíô –ó–∞–±–æ—Ç–ª–∏–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞",
                        "üî• –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å",
                        "üíº –í—ã–¥–µ–ª–µ–Ω–Ω—ã–π IP –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã"
                    ],
                    speed: "~40 –ú–±–∏—Ç/—Å",
                    plan_color: "color-purple",
                    button_color: "",
                },
            ];

            const preparePrice = (price, currency) => {
                let currency_position = "left"
                if (currency == "‚ÇΩ") {
                    currency_position = "right"
                }

                if (typeof price == "string") {
                    return price
                }
                return `${currency_position === "right" ? `${price}${currency}` : `${currency}${price}`}`
            };
            const arrayToHtml = (array) => {
                let html = "";
                array.forEach(item => html += item);
                return html;

            }
            const plural = (value, words) => {
                value = Math.abs(value) % 100;
                const num = value % 10;
                if (value > 10 && value < 20) return words[2];
                if (num > 1 && num < 5) return words[1];
                if (num == 1) return words[0];
                return words[2];

            };
            const product = (product) => {
                return `
     <div class="col-md-6 col-lg-3 col-sm-12 mb-3">
        <div class="card">
            <div class="card-header">
                                           <span class="card-header-icon">${product.icon}</span>

                <h4 class="plan-name ${product.plan_color}">
                    ${product.name}
                </h4>
                <div class="header-secondary">
                    <p>${product.description}</p>
                </div>
            </div>
            <div class="card-body">
                <div style="min-height: auto;" class="vertical-margin flex-grow-price-block">
                    <div class="price-wrap">
                        <div class="card-price">
                            <h4>${preparePrice(product.price, product.currency)} ${typeof product.price == "string" ? '' : '–≤ –º–µ—Å—è—Ü'}  </h4>
                            ${typeof product.price != "string" ? `<p class="card-price-description" >–ü—Ä–∏ –æ–ø–ª–∞—Ç–µ –∑–∞ –≥–æ–¥</p>` : `<p>${product.secondary_info}</p>`}

                            ${arrayToHtml(product.plans.map(plan => `<p class="card-price-description"><b>${preparePrice(plan.price, plan.currency)}</b> –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –∑–∞ ${plan.period} ${plural(plan.period, ["–º–µ—Å—è—Ü", "–º–µ—Å—è—Ü–∞", "–º–µ—Å—è—Ü–µ–≤"])}</p>`))}
                        </div>
                    </div>
                </div>
                <div class="vertical-margin">
                    <div class="card-action">
                        <button class="btn card-btn-buy ${product.button_color}">${product.button}</button>
                    </div>
                </div>
                <div class="vertical-margin">
                    <ul class="features-list">
                    ${arrayToHtml(product.features.map(feature => `<li>${feature}</li>`))}
                    </ul>
                </div>
            </div>
        </div>
    </div>`
            };
            const makeButtonsScroll = () => {
                const buttonsCard = document.querySelectorAll('.card-btn-buy')
                if (buttonsCard) {
                    buttonsCard.forEach(button => {
                        button.addEventListener('click', event => {
                            document.querySelector(config[environment].buttonBlockId).scrollIntoView({behavior: "smooth"})
                        })
                    })
                }
            }

            const renderProducts = (products) => {
                const cardRow = document.querySelector('.cards');
                if (cardRow) {
                    while (cardRow.firstChild) {
                        cardRow.removeChild(cardRow.lastChild);
                    }

                    products.forEach(productItem => cardRow.insertAdjacentHTML('beforeend', product(productItem)));
                }
                makeButtonsScroll()

            }

            const prepareItems = (items, currency) => {

                return items.map(item => {
                    const dataForReplace = item.currencies.filter(currencyItem => currencyItem.currency === currency)[0];
                    if (dataForReplace) {
                        item = {
                            ...item, ...dataForReplace, currencies: {
                                currency: item.currency,
                                price: item.price,
                                period: 12,
                                plans: item.plans,
                            }
                        }
                    }
                    return item
                })
            }

            let productsPrepared = prepareItems(items, defaultCurrency);

            renderProducts(productsPrepared);

            document.querySelector('.custom-switch-box').addEventListener('click', (eventSelectItem) => {
                const target = eventSelectItem.target.closest('.radio-currency')
                const targetInput = target.querySelector('input')
                const parent = eventSelectItem.target.closest('.custom-switch-box')
                if (target) {
                    parent.querySelectorAll('li input').forEach(element => element.checked = false)
                    target.querySelector('input').checked = true;
                    const products = prepareItems(items, targetInput.dataset.value)

                    localStorage.setItem('defaultCurrency', targetInput.dataset.value)

                    renderProducts(products)
                }
            })
        }

        const interval = setInterval(() => {
            let replace = document.querySelector('.notion-table__wrapper')
            if (replace) {
                appendBlock(replace);
                clearInterval(interval);
            }
        }, 1000);
    })
</script>

<script>
    // <h1 class="mb-4" style="main-title">–ó–∞–∫–∞–∂–∏—Ç–µ –∫–ª—é—á</h1>
    window.addEventListener('load', () => {
        // const test = (window.location.hash.includes("debug") || window.location.search.includes("debug"));
        const formEnabled = true;
        const content = `<div id="form-block" class="form-container mx-auto px-4">
        
        <form class="form-data-person">
            <div class="form-group">
                <label for="InputEmail">Email <span class="required-dot">*</span></label>
                <input type="email" class="form-control" id="InputEmail">
                <small id="emailHelp" class="form-text text-muted">–ù–∞ –Ω–µ–≥–æ –ø—Ä–∏–¥—ë—Ç —Ñ–∞–π–ª-–∫–ª—é—á</small>
            </div>
            <div class="form-subscription" id="form-subscription">
            </div>
            <div class=" w-full  w-full px-2"></div>
            <div class="form-agreement">
                <div id="agrrement_box">
                    <div  class="form-agreement_item" id="checkAgree">
                        <input id="agree" name="agree" type="checkbox"
                            class="custom-checkbox_input"><label
                            for="agree" class="custom-checkbox_label">
                        –°–æ–≥–ª–∞—à–∞—é—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ ‚òùÔ∏è <span class="required-dot">*</span></label>
                    </div>
                </div>
            </div>

            <div class="border-b my-4" id="border-b my-4"></div>
            <div class="form-politic mb-3 "><p>üîí –û—Ç–ø—Ä–∞–≤–ª—è—è
                –∑–∞—è–≤–∫—É, –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ <a href="https://vpn-naoborot.online/docs/privacy-policy"
                                            rel="nofollow noreferrer noopener" target="_blank">–ø–æ–ª–∏—Ç–∏–∫—É
                    –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>, <a href="https://vpn-naoborot.online/docs/oferta"
                                                rel="nofollow noreferrer noopener"
                                                target="_blank"><span>–æ—Ñ–µ—Ä—Ç—É</span></a> –∏ <a
                        href="https://vpn-naoborot.online/docs/terms-of-service" rel="nofollow noreferrer noopener"
                        target="_blank">—É—Å–ª–æ–≤–∏—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è</a>.</p></div>

            <div class="d-flex align-items-center justify-content-center w-full">
                <button id="submit-button" type="submit" class="btn btn-primary"> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
            </div>

        </form>
        </div>`;

        let captchaWidgetId;
        
        function getCaptchaToken() {
            if (captchaWidgetId !== undefined) {
                return grecaptcha.enterprise.getResponse(captchaWidgetId);
            }
            return null;
        }
        const appendBlock = (replace) => {
            if (formEnabled && replace) {

                let plans = [
                    {
                        icon: "ü§ù",
                        name: "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π",
                        price: "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ",
                        currency: "‚ÇΩ",
                        period: 12,
                        currencies: [
                            {
                                currency: "‚Ç¨",
                                price: "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ",
                                plans: []
                            },
                        ],
                        plans: [],
                        tariff: "ü§ù –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π",
                        selected: false,
                    },
                    {
                        name: "–î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤",
                        tariff: "üìÇ –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤",
                        icon: "üìÇ",
                        price: 1.5,
                        currency: "‚Ç¨",
                        period: 12,
                        currencies: [
                            {
                                currency: "‚ÇΩ",
                                price: 150,
                                period: 12,
                                plans: [
                                    {
                                        period: 6,
                                        price: 190,
                                        currency: "‚ÇΩ"
                                    },
                                    {
                                        period: 1,
                                        price: 290,
                                        currency: "‚ÇΩ"
                                    },
                                ],
                            }
                        ],
                        plans: [
                            {
                                period: 6,
                                price: 2,
                                currency: "‚Ç¨"
                            },
                            {
                                period: 1,
                                price: 3,
                                currency: "‚Ç¨"
                            },
                        ],
                        selected: true,
                    },
                    {
                        icon: "üì∫",
                        name: "–î–ª—è –≤–∏–¥–µ–æ",
                        tariff: "üì∫ –î–ª—è –≤–∏–¥–µ–æ",
                        price: 3,
                        currency: "‚Ç¨",
                        period: 12,
                        currencies: [
                            {
                                currency: "‚ÇΩ",
                                price: 290,
                                period: 12,
                                plans: [
                                    {
                                        period: 6,
                                        price: 450,
                                        currency: "‚ÇΩ"
                                    },
                                    {
                                        period: 1,
                                        price: 590,
                                        currency: "‚ÇΩ"
                                    },
                                ],
                            }
                        ],
                        plans: [
                            {
                                period: 6,
                                price: 4.5,
                                currency: "‚Ç¨"
                            },
                            {
                                period: 1,
                                price: 6,
                                currency: "‚Ç¨"
                            },
                        ],
                        selected: false,
                    },
                    {
                        icon: "üòé",
                        tariff: "üòé –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π",
                        name: "–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π",
                        price: 8,
                        currency: "‚Ç¨",
                        period: 12,
                        currencies: [
                            {
                                currency: "‚ÇΩ",
                                price: 790,
                                period: 12,
                                plans: [
                                    {
                                        period: 6,
                                        price: 990,
                                        currency: "‚ÇΩ"
                                    },
                                    {
                                        period: 1,
                                        price: 1490,
                                        currency: "‚ÇΩ"
                                    },
                                ],
                            }
                        ],
                        plans: [
                            {
                                period: 6,
                                price: 10,
                                currency: "‚Ç¨"
                            },
                            {
                                period: 1,
                                price: 15,
                                currency: "‚Ç¨"
                            },
                        ],
                        selected: false,
                    }
                ];

                replace.firstElementChild.innerHTML = content;
                
                window.addEventListener('click', (event) => {
                    const lists = document.querySelectorAll('.custom-selection-list')
                    const target = event.target
                    lists.forEach(item => {
                        if (item !== target && item.classList.contains('active') && target.nodeName !== "BUTTON") {
                            item.classList.remove('active')
                            console.log(2)
                        }
                    })
                })
                const prepareItemsCurrency = (items, currency) => {

                    return items.map(item => {
                        const dataForReplace = item.currencies.filter(currencyItem => currencyItem.currency === currency)[0];
                        if (dataForReplace) {
                            item = {
                                ...item, ...dataForReplace, currencies: [{
                                    currency: item.currency,
                                    price: item.price,
                                    period: item.period,
                                    plans: item.plans,
                                }]
                            }
                        }
                        return item
                    })
                }
                const addEventsToSelections = () => {
                    const selections = document.querySelectorAll('.custom-selection');
                    selections.forEach(item => {
                        // –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
                        item.querySelector('.custom-selection-list').addEventListener('click', (event) => {
                            event.preventDefault();
                            event.stopPropagation();
                            const target = event.target.closest('li')
                            const parent = target.closest('.custom-selection-list');
                            const primaryParent = target.closest('.custom-selection');
                            const button = primaryParent.querySelector('button');
                            const prev = parent.querySelectorAll('.select-option');
                            prev.forEach(item => item.classList.remove('active'))
                            target.classList.add('active')
                            parent.classList.remove('active')
                            button.dataset.name = target.dataset.name
                            button.dataset.value = target.dataset.value
                            button.textContent = target.dataset.name;

                            switch (primaryParent.dataset.type) {
                                case "tariff_type":
                                    plans = plans.map(pl => {
                                        pl.selected = false;
                                        console.log(pl.tariff === target.dataset.value, pl.tariff, target.dataset.value)
                                        if (pl.tariff === target.dataset.value) {
                                            pl.selected = true;
                                        }
                                        return pl
                                    })
                                    break;
                                case "payment_type":
                                    plans = prepareItemsCurrency(plans, target.dataset.value)
                                    console.log(plans)
                                    break;
                                case "sub_type":
                                    plans = plans.map(pl => {
                                        if (pl.period !== target.dataset.value) {
                                            pl.plans = pl.plans.map(currentPlan => {
                                                if (currentPlan.period === parseInt(target.dataset.value)) {
                                                    const originalPlan = {
                                                        period: pl.period,
                                                        price: pl.price,
                                                        currency: pl.currency
                                                    }
                                                    pl.period = currentPlan.period;
                                                    pl.price = currentPlan.price;
                                                    pl.currency = currentPlan.currency;
                                                    currentPlan.period = originalPlan.period;
                                                    currentPlan.price = originalPlan.price;
                                                    currentPlan.currency = originalPlan.currency;
                                                }

                                                return currentPlan;
                                            })
                                            pl.currencies.map(currency => {
                                                currency.plans = currency.plans.map(currencyPlanDeep => {
                                                    if (currencyPlanDeep.period === parseInt(target.dataset.value)) {
                                                        const originalPlan = {
                                                            period: currency.period,
                                                            price: currency.price,
                                                            currency: currency.currency
                                                        }
                                                        currency.period = currencyPlanDeep.period;
                                                        currency.price = currencyPlanDeep.price;
                                                        currency.currency = currencyPlanDeep.currency;
                                                        currencyPlanDeep.period = originalPlan.period;
                                                        currencyPlanDeep.price = originalPlan.price;
                                                        currencyPlanDeep.currency = originalPlan.currency;
                                                    }

                                                    return currencyPlanDeep;
                                                })

                                                return currency;
                                            })
                                        }
                                        return pl
                                    })
                                    break
                            }
                            console.log(plans[1].currencies[0], plans[1].period, target.dataset.value)
                            renderSelections(plans)
                        })

                        const button = item.querySelector('button');
                        button.addEventListener('click', (event) => {
                            event.preventDefault();
                            button.focus();
                            const list = event.target.nextElementSibling;
                            const selections = document.querySelectorAll('.custom-selection .custom-selection-list');
                            selections.forEach(elem => elem.classList.remove('active'))
                            list.classList.toggle('active')
                        })
                    });
                }
                const plural = (value, words) => {
                    value = Math.abs(value) % 100;
                    const num = value % 10;
                    if (value > 10 && value < 20) return words[2];
                    if (num > 1 && num < 5) return words[1];
                    if (num == 1) return words[0];
                    return words[2];

                };
                const arrayToHtml = (array) => {
                    let html = "";
                    array.forEach(item => html += item);
                    return html;

                }
                const selectTemplate = (subscription, select) => {
                    const options = select.options();
                    const html = select.html();

                    return `<div class="form-group">
                    <label>${subscription.name} <span class="required-dot">*</span></label>
                    <div data-type="${subscription.type}" class="custom-selection ${subscription?.active ? 'active' : ''}">
                        <button class="custom-selection-name" id="id-${subscription.type}" data-name="${select.selected_name}"
                                data-value="${select.value}">${select.selected_name}</button>
                        <ul class="custom-selection-list">
                        ${arrayToHtml(options.map(item => `<li class="select-option${select.selected_name === item.name ? ' active' : ''}" data-name="${item.name}" data-value="${item.value}">${item.name}</li>`))}
                        </ul>
                        ${select.description}
                    </div>

                </div>
                <div class="${html.length > 0 ? 'form-group-after w-100' : ''}">${html}</div>
`
                }
                const selectionsData = (plans) => {
                    const activePlan = plans.filter(item => item.selected === true)[0]
                    return [
                        {
                            name: "–¢–ê–†–ò–§",
                            type: "tariff_type",
                            value: {
                                selected_name: activePlan.tariff,
                                value: activePlan.currency,
                                description: "",
                                options: () => {
                                    return plans.map(item => {
                                        return {
                                            name: item.tariff,
                                            value: item.tariff
                                        }
                                    })
                                },
                                html: () => {
                                    if (activePlan.name === "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π") {
                                        let captchaElement = document.getElementById("captcha_box");
                                        
                                        if (!captchaElement) {
                                            captchaElement = document.createElement("div");
                                            captchaElement.id = "captcha_box";
                                            captchaElement.style = ".captcha_box";
                                            
                                            // console.log(captchaId);
                                            
                                            let formSubscriptionElement = document.getElementById("border-b my-4");
                                            formSubscriptionElement.appendChild(captchaElement);
                                            captchaWidgetId = grecaptcha.enterprise.render('captcha_box', {
                                                'sitekey' : "6LfPLEIoAAAAAEn8NaCcwWtdv0qTUFmAAKF_ufhW",
                                                'action' : 'SELECTED_FREE_PLAN',
                                                'data-sitekey' : "6LfPLEIoAAAAAEn8NaCcwWtdv0qTUFmAAKF_ufhW",
                                                'data-action' : "SELECTED_FREE_PLAN"
                                            });
                                        }
                                    } else {
                                        let captchaElement = document.getElementById("captcha_box");
                                        
                                        if (captchaElement) {
                                            //captchaElement.parentNode.removeChild(captchaElement);
                                        }
                                    }
                                    return "";
                                }
                            },
                        },
                        {
                            name: "–°–ü–û–°–û–ë –û–ü–õ–ê–¢–´",
                            type: "payment_type",
                            value: {
                                selected_name: activePlan.currency === "‚Ç¨" ? "–ó–∞—Ä—É–±–µ–∂–Ω–æ–π –∫–∞—Ä—Ç–æ–π" : "–†–æ—Å—Å–∏–π—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π",
                                value: activePlan.currency,
                                description: ``,
                                options: () => {
                                    return [
                                        {
                                            name: "–ó–∞—Ä—É–±–µ–∂–Ω–æ–π –∫–∞—Ä—Ç–æ–π",
                                            value: "‚Ç¨"
                                        },
                                        {
                                            name: "–†–æ—Å—Å–∏–π—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π",
                                            value: "‚ÇΩ"
                                        }
                                    ];
                                },
                                html: function () {

                                    return this.value === "‚ÇΩ" ? `<p class="m-0">–õ—É—á—à–µ –ø–ª–∞—Ç–∏—Ç—å —Å <strong>–∑–∞—Ä—É–±–µ–∂–Ω–æ–π –∫–∞—Ä—Ç—ã</strong>:</p><ul><li>üí∞ –¢–∞–∫ –¥–µ—à–µ–≤–ª–µ </li><li>üì± –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ApplePay –∏ GooglePay</li><li>üíô –≠—Ç–æ <strong>–Ω–∞–º–Ω–æ–≥–æ</strong> —É–¥–æ–±–Ω–µ–µ –¥–ª—è –Ω–∞—Å </li></ul>` : '';
                                }
                            }
                        },
                        {
                            name: "–ü–ï–†–ò–û–î –ü–û–î–ü–ò–°–ö–ò",
                            type: "sub_type",
                            value: {
                                description: `<small>–ö–∞–∫ —á–∞—Å—Ç–æ —Å–ø–∏—Å—ã–≤–∞—Ç—å –¥–µ–Ω—å–≥–∏</small>`,
                                selected_name: activePlan.period === 12 ? "1 –ì–æ–¥" : activePlan.period + ' ' + plural(activePlan.period, ['–ú–µ—Å—è—Ü', '–ú–µ—Å—è—Ü–∞', '–ú–µ—Å—è—Ü–µ–≤']),
                                value: activePlan.period,
                                options: () => {
                                    const tariff = [{
                                        period: activePlan.period,
                                        price: activePlan.price,
                                        currency: activePlan.currency
                                    }].concat(activePlan.plans).sort((a, b) => a.period > b.period ? -1 : b.period > a.period ? 1 : 0)

                                    return tariff.map(tar => {
                                        return {
                                            name: tar.period === 12 ? 1 + ' ' + plural(tar.period, ['–ì–æ–¥', '–ì–æ–¥–∞', '–ì–æ–¥']) : tar.period + ' ' + plural(tar.period, ['–ú–µ—Å—è—Ü', '–ú–µ—Å—è—Ü–∞', '–ú–µ—Å—è—Ü–µ–≤']),
                                            value: tar.period,
                                            period: tar.period,
                                            price: tar.price,
                                            currency: tar.currency
                                        }
                                    })
                                },
                                html: function () {
                                    const options = this.options();
                                    const option = options.filter(e => e.name === this.selected_name)[0];
                                    const one_month = options.filter(e => e.period === 1)[0];

                                    if (!one_month) {
                                        return "";
                                    }
                                    const plural_word = option.period === 12 ? "–≤ –≥–æ–¥" : (option.period === 1 ? "–≤ –º–µ—Å—è—Ü" : "–∑–∞ " + option.period + " " + plural(option.period, ["–º–µ—Å—è—Ü", "–º–µ—Å—è—Ü–∞", "–º–µ—Å—è—Ü–µ–≤"]));

                                    if (option.currency === '‚ÇΩ') {
                                        const phrase = ` (c–∫–∏–¥–∫–∞ ${(one_month.price * option.period) - (option.price * option.period)} ${option.currency})`;
                                        return `<p>  ${option.period > 1 ? `<span class="line-through">${one_month.price *option.period }${option.currency} </span>` : ''}
                                                        ${option.price * option.period}${option.currency}  ${option.period !== 1 ? plural_word + phrase : plural_word} </p>`
                                    }
                                    const phrase = ` (c–∫–∏–¥–∫–∞ ${option.currency}${(one_month.price * option.period) - (option.price * option.period)} )`;
                                    return `<p>  ${option.period > 1 ? `<span class="line-through">${option.currency}${one_month.price *option.period } </span>` : ''}
                                                     ${option.currency}${option.price * option.period}  ${option.period !== 1 ? plural_word + phrase : plural_word} </p>`

                                }
                            }
                        }
                    ]
                };

                const renderSelections = (plans) => {

                    const cardRow = document.querySelector('.form-subscription')
                    if (cardRow) {
                        while (cardRow.firstChild) {
                            cardRow.removeChild(cardRow.lastChild);
                        }
                    }
                    const data = selectionsData(plans);

                    const activePlan = plans.filter(item => item.selected === true)[0]
                    const agreement_box = document.querySelector('#agrrement_box');

                    const inputAgree = `<div  class="form-agreement_item" id="checkAgree">
                                            <input id="agree" name="agree" type="checkbox"
                                                class="custom-checkbox_input"><label
                                                for="agree" class="custom-checkbox_label">
                                            –°–æ–≥–ª–∞—à–∞—é—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ ‚òùÔ∏è <span class="required-dot">*</span></label>
                                        </div>`;

                    data.forEach((sub, index) => {
                        if (activePlan.name === "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π") {
                            if (sub.type === "tariff_type") {
                                while (agreement_box.firstChild) {
                                    agreement_box.removeChild(agreement_box.lastChild);
                                }
                                cardRow.insertAdjacentHTML('beforeend', selectTemplate(sub, sub.value))
                            }
                        } else {
                            cardRow.insertAdjacentHTML('beforeend', selectTemplate(sub, sub.value))
                        }
                    });
                    addEventsToSelections();
                }
                renderSelections(plans);
            }

            const emailInputElement = document.getElementById('InputEmail');
            if (emailInputElement) {  // —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                emailInputElement.addEventListener('blur', function() {
                    const email = emailInputElement.value;
                    const existingHint = document.querySelector('.hint-message-InputEmail');
                    
                    if (isValidEmail(email) && existingHint) {
                        existingHint.remove();
                        emailInputElement.classList.remove('invalid-input');
                    }
                });
            }

            const checkboxDiv = document.getElementById('checkAgree');
            const checkbox = document.getElementById('agree');
            if (checkboxDiv) {  // —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                checkbox.addEventListener('change', function() {
                    const existingHintAgree = document.querySelector('.hint-message-checkAgree');
                    
                    if (checkbox.checked && existingHintAgree) {
                        existingHintAgree.remove();
                        checkboxDiv.classList.remove('invalid-agree'); // –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
                    }
                });
            }

        }

        function isValidEmail(email) {
            const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
            return emailPattern.test(email);
        }

        function addHint(elementId, message) {
            const inputElement = document.getElementById(elementId);
            const hintElement = document.createElement('div');
            
            hintElement.className = `hint-message-${elementId}`;
            hintElement.style.color = 'red';
            hintElement.style.fontSize = '14px';
            hintElement.textContent = message;

            const existingHint = document.querySelector(`.hint-message-${elementId}`);
            if (existingHint) {
                existingHint.remove();
            }

            inputElement.insertAdjacentElement('afterend', hintElement);
        }

        function showLoader() {
            console.log("Loading...")
            submitButton = document.getElementById('submit-button');
            submitButton.innerHTML = "–û—Ç–ø—Ä–∞–≤–∫–∞..."
            submitButton.disabled = true;
        }

        function showSuccess() {
            console.log("Success!")
            const successContent = `<h1>‚úÖ –û—Ç–ª–∏—á–Ω–æ!</h1>
                                    <div>
                                        <br>
                                        –ú—ã –ø–æ–ª—É—á–∏–ª–∏ –∑–∞—è–≤–∫—É –∏ –ø—Ä–∏—à–ª—ë–º –∫–ª—é—á –Ω–∞ –ø–æ—á—Ç—É.
                                        <br><br>
                                        <b>‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–∞–ø–∫–∏ –°–ü–ê–ú –∏ –†–ê–°–°–´–õ–ö–ò</b>
                                        <br><br>
                                        –°–ø–∞—Å–∏–±–æ!
                                    </div>`
            document.getElementById('form-block').innerHTML = successContent
        }

        function showError() {
            console.log("Error!")
            const errorContent = `<h1>üö® –û–π-–æ–π!</h1>
                                <div>
                                <br>
                                –ü—Ä–æ–∏–∑–æ—à–ª–∞ –∫–∞–∫–∞—è-—Ç–æ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.
                                <br><br>
                                <b>–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º <a href="mailto:support@vpn-naoborot.online">support@vpn-naoborot.online</a></b>
                                <br><br>
                                –°–ø–∞—Å–∏–±–æ!
                                </div>`
            document.getElementById('form-block').innerHTML = errorContent
        }

        function submitData() {

            const planElement = document.getElementById('id-tariff_type');
            const paymentMethodElement = document.getElementById('id-payment_type');
            const periodElement = document.getElementById('id-sub_type');
            const emailInputElement = document.getElementById('InputEmail');

            const planName = planElement ? planElement.innerText : "";
            const paymentMethod = paymentMethodElement ? paymentMethodElement.innerText : "–ó–∞—Ä—É–±–µ–∂–Ω–æ–π –∫–∞—Ä—Ç–æ–π";
            const period = periodElement ? periodElement.innerText : "1 –ì–æ–¥";
            
            const email = emailInputElement.value;
            const existingHintEmail = document.querySelector('.hint-message-InputEmail');
            if (!isValidEmail(email)) {
                addHint('InputEmail', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email');
                document.getElementById('InputEmail').classList.add('invalid-input');
                return;
            } else if (existingHintEmail) {
                existingHintEmail.remove();
            }

            const checkbox = document.getElementById('agree');
            const existingHintAgree = document.querySelector('.hint-message-checkAgree');
            console.log("Checkbox checked status:", checkbox.checked);
            
            if (!checkbox.checked) {
                addHint('checkAgree', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–≥–ª–∞—Å–∏—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã!');
                document.getElementById('checkAgree').classList.add('invalid-agree');
                return;
            } else if (existingHintAgree) {
                existingHintAgree.remove();
            }

            let formData = {
                submission:{
                    "–¢–∞—Ä–∏—Ñ": planName,
                    "Email": email,
                    "–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã": paymentMethod,
                    "–ü–µ—Ä–∏–æ–¥ –ø–æ–¥–ø–∏—Å–∫–∏": period,
                }
            };

            var billing_cycles = {
                "1 –ú–µ—Å—è—Ü": "1-month",
                "6 –ú–µ—Å—è—Ü–µ–≤": "6-month",
                "1 –ì–æ–¥": "1-year"
            }
            let message = {
                billing_cycle: billing_cycles[period],
                email: email,
                paymentMethod: paymentMethod,
                status: "success",
                tarif: planName
            };

            if (planName === "ü§ù –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π") {
                const captchaToken = getCaptchaToken();
                if (!captchaToken) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≤–µ—Ä—à–∏—Ç–µ reCAPTCHA –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.');
                    return;
                }
                formData.captcha = captchaToken;
            }

            console.log('formData:', formData);
            showLoader();

            const TIMEOUT = 10000; // 10 —Å–µ–∫—É–Ω–¥

            const timeoutPromise = new Promise((_, reject) => {
                setTimeout(() => {
                    reject(new Error('Request timed out'));
                }, TIMEOUT);
            });

            Promise.race([
                            fetch('https://api.vpn-naoborot.online/v1/api/create-submission-webhook/', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Accept': '*/*'
                                },
                                body: JSON.stringify(formData)
                            }),
                            timeoutPromise
                        ])
                        .then(response => {
                            if (!response.ok) {
                                message.status = "fail";
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            console.log(data);
                            message.status = "success";
                            showSuccess(); // Show success message or action
                        })
                        .catch(error => {
                            console.error("Error:", error);
                            message.status = "fail";
                            showError(); // Show error message or action
                        })
                        .finally(() => {
                            console.log(message);
                            window.postMessage(JSON.stringify(message), config[environment].address);
                        });
        }

        const interval = setInterval(() => {
            let replace = document.querySelector(config[environment].replaceBlockId);

            if (replace) {
                appendBlock(replace);
                clearInterval(interval);
                document.querySelector('.btn.btn-primary').addEventListener('click', function(e) {
                    e.preventDefault();
                    submitData();
                });
            }
        }, 1000);
    });
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/VPN-Naoborot/vpnn-landing@main/dist/assets/css/libs.css">
